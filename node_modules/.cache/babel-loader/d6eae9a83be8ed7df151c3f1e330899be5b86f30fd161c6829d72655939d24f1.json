{"ast":null,"code":"const {\n  initializeApp\n} = require(\"firebase/app\");\nconst {\n  getAuth,\n  createUserWithEmailAndPassword,\n  signInWithEmailAndPassword,\n  browserSessionPersistence,\n  setPersistence,\n  signOut,\n  browserLocalPersistence,\n  inMemoryPersistence\n} = require(\"firebase/auth\");\nconst firebaseConfig = {\n  apiKey: \"AIzaSyDhKNCusOPW2y52bMwLnOrXIy-u1y1Q4KI\",\n  authDomain: \"bank-f0c47.firebaseapp.com\",\n  projectId: \"bank-f0c47\",\n  storageBucket: \"bank-f0c47.appspot.com\",\n  messagingSenderId: \"710670974978\",\n  appId: \"1:710670974978:web:b724e76530555264b8271b\"\n};\nconst firebaseApp = initializeApp(firebaseConfig);\nconst auth = getAuth();\nsetPersistence(auth, inMemoryPersistence);\nasync function createFirebase(name, email, password, requestedRole) {\n  if (!db) {\n    throw new Error('Database connection not established');\n  }\n  try {\n    if (await checkAccount(email)) {\n      return true;\n    } else {\n      await createUserWithEmailAndPassword(auth, email, password);\n      return await create(name, email, requestedRole);\n    }\n  } catch (error) {\n    console.error('Error creating user with Firebase:', error.code, error.message);\n    throw error;\n  }\n}\nasync function loginFirebase(email, password, setCurrentUser) {\n  try {\n    await signInWithEmailAndPassword(auth, email, password);\n    console.log('firebase sign in successful');\n    try {\n      const url = \"/account/login/\".concat(email);\n      var res = await fetch(url);\n      var data = await res.json();\n      console.log(\"data: \".concat(data));\n      if (data.code && data.name === 'FirebaseError') {\n        alert(\"Something went wrong. Please check your credentials and try again.\");\n        return;\n      }\n      setCurrentUser({\n        email: data.email,\n        name: data.name,\n        balance: data.balance,\n        role: data.role\n      });\n    } catch (error) {\n      console.error('Error logging in with Mongo:', error.code, error.message);\n      return error;\n    }\n  } catch (error) {\n    console.error('Error logging in with Firebase:', error.code, error.message);\n    return error;\n  }\n}\nasync function logout() {\n  try {\n    await signOut(auth);\n    return;\n  } catch (error) {\n    console.error('Error during logout:', error);\n    throw error;\n  }\n}\nasync function checkAuthorization() {\n  const user = auth.currentUser;\n  if (user) {\n    const authorizationURL = \"/authorization/\";\n    try {\n      const res = await fetch(authorizationURL);\n      if (res.ok) {\n        let user = await res.json();\n        if (!user.email) {\n          setCurrentUser({\n            name: '',\n            email: '',\n            balance: 0,\n            password: '',\n            role: 'none'\n          });\n          navigate('/');\n        }\n      }\n    } catch (err) {\n      console.error(err);\n    }\n  } else {\n    return console.log(\"no user found\");\n  }\n}\nmodule.exports = {\n  createFirebase,\n  loginFirebase,\n  logout,\n  checkAuthorization\n};","map":{"version":3,"names":["initializeApp","require","getAuth","createUserWithEmailAndPassword","signInWithEmailAndPassword","browserSessionPersistence","setPersistence","signOut","browserLocalPersistence","inMemoryPersistence","firebaseConfig","apiKey","authDomain","projectId","storageBucket","messagingSenderId","appId","firebaseApp","auth","createFirebase","name","email","password","requestedRole","db","Error","checkAccount","create","error","console","code","message","loginFirebase","setCurrentUser","log","url","concat","res","fetch","data","json","alert","balance","role","logout","checkAuthorization","user","currentUser","authorizationURL","ok","navigate","err","module","exports"],"sources":["/Users/Regan/Documents/GitHub/BadBank/public/src/Components/firebase.js"],"sourcesContent":["const { initializeApp } = require(\"firebase/app\");\nconst { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, browserSessionPersistence, setPersistence, signOut, browserLocalPersistence, inMemoryPersistence } = require(\"firebase/auth\");\n\nconst firebaseConfig = {\n    apiKey: \"AIzaSyDhKNCusOPW2y52bMwLnOrXIy-u1y1Q4KI\",\n    authDomain: \"bank-f0c47.firebaseapp.com\",\n    projectId: \"bank-f0c47\",\n    storageBucket: \"bank-f0c47.appspot.com\",\n    messagingSenderId: \"710670974978\",\n    appId: \"1:710670974978:web:b724e76530555264b8271b\"\n  };\n  \n  const firebaseApp = initializeApp(firebaseConfig);\n  const auth = getAuth();\n  setPersistence(auth, inMemoryPersistence);\n\n  async function createFirebase(name, email, password, requestedRole) {\n    if (!db) {\n        throw new Error('Database connection not established');\n    }\n    try {\n        if (await checkAccount(email)) {\n            return true;\n        } else {\n                await createUserWithEmailAndPassword(auth, email, password);\n                return await create(name, email, requestedRole);          \n        }\n      } catch (error) {\n        console.error('Error creating user with Firebase:', error.code, error.message);\n        throw error;\n      }\n  }\n\n  async function loginFirebase(email, password, setCurrentUser) {\n    try {\n        await signInWithEmailAndPassword(auth, email, password);\n        console.log('firebase sign in successful');\n        try {    \n            const url = `/account/login/${email}`;\n                    var res = await fetch(url);\n                 var data = await res.json();\n                 console.log(`data: ${data}`);\n                 if (data.code && data.name === 'FirebaseError') {\n                    alert(\"Something went wrong. Please check your credentials and try again.\")\n                    return;\n                 }\n                     setCurrentUser({\n                         email: data.email,\n                         name: data.name,\n                         balance: data.balance,\n                         role: data.role\n                       });  \n                    } catch (error) {\n                console.error('Error logging in with Mongo:', error.code, error.message);\n                return(error);\n            }\n    } catch (error) {\n        console.error('Error logging in with Firebase:', error.code, error.message);\n        return(error);\n    }\n}\n\nasync function logout() {\n    try {\n        await signOut(auth);\n        return;\n    } catch (error) {\n        console.error('Error during logout:', error);\n        throw error;\n    }\n}\n\nasync function checkAuthorization() {\n    const user = auth.currentUser;\n\n    if (user) {\n        const authorizationURL = `/authorization/`;\n    try {\n        const res = await fetch(authorizationURL);\n        if (res.ok) {\n            let user = await res.json();\n            if (!user.email) {\n                setCurrentUser({\n                    name: '',\n                    email: '',\n                    balance: 0,\n                    password: '',\n                    role: 'none'\n                });\n                navigate('/');\n            }\n        }\n    } catch(err) {\n        console.error(err);\n    }\n    } else {\n     return console.log(`no user found`);\n    }\n}\n\n  module.exports = {createFirebase, loginFirebase, logout, checkAuthorization}"],"mappings":"AAAA,MAAM;EAAEA;AAAc,CAAC,GAAGC,OAAO,CAAC,cAAc,CAAC;AACjD,MAAM;EAAEC,OAAO;EAAEC,8BAA8B;EAAEC,0BAA0B;EAAEC,yBAAyB;EAAEC,cAAc;EAAEC,OAAO;EAAEC,uBAAuB;EAAEC;AAAoB,CAAC,GAAGR,OAAO,CAAC,eAAe,CAAC;AAE1M,MAAMS,cAAc,GAAG;EACnBC,MAAM,EAAE,yCAAyC;EACjDC,UAAU,EAAE,4BAA4B;EACxCC,SAAS,EAAE,YAAY;EACvBC,aAAa,EAAE,wBAAwB;EACvCC,iBAAiB,EAAE,cAAc;EACjCC,KAAK,EAAE;AACT,CAAC;AAED,MAAMC,WAAW,GAAGjB,aAAa,CAACU,cAAc,CAAC;AACjD,MAAMQ,IAAI,GAAGhB,OAAO,CAAC,CAAC;AACtBI,cAAc,CAACY,IAAI,EAAET,mBAAmB,CAAC;AAEzC,eAAeU,cAAcA,CAACC,IAAI,EAAEC,KAAK,EAAEC,QAAQ,EAAEC,aAAa,EAAE;EAClE,IAAI,CAACC,EAAE,EAAE;IACL,MAAM,IAAIC,KAAK,CAAC,qCAAqC,CAAC;EAC1D;EACA,IAAI;IACA,IAAI,MAAMC,YAAY,CAACL,KAAK,CAAC,EAAE;MAC3B,OAAO,IAAI;IACf,CAAC,MAAM;MACC,MAAMlB,8BAA8B,CAACe,IAAI,EAAEG,KAAK,EAAEC,QAAQ,CAAC;MAC3D,OAAO,MAAMK,MAAM,CAACP,IAAI,EAAEC,KAAK,EAAEE,aAAa,CAAC;IACvD;EACF,CAAC,CAAC,OAAOK,KAAK,EAAE;IACdC,OAAO,CAACD,KAAK,CAAC,oCAAoC,EAAEA,KAAK,CAACE,IAAI,EAAEF,KAAK,CAACG,OAAO,CAAC;IAC9E,MAAMH,KAAK;EACb;AACJ;AAEA,eAAeI,aAAaA,CAACX,KAAK,EAAEC,QAAQ,EAAEW,cAAc,EAAE;EAC5D,IAAI;IACA,MAAM7B,0BAA0B,CAACc,IAAI,EAAEG,KAAK,EAAEC,QAAQ,CAAC;IACvDO,OAAO,CAACK,GAAG,CAAC,6BAA6B,CAAC;IAC1C,IAAI;MACA,MAAMC,GAAG,qBAAAC,MAAA,CAAqBf,KAAK,CAAE;MAC7B,IAAIgB,GAAG,GAAG,MAAMC,KAAK,CAACH,GAAG,CAAC;MAC7B,IAAII,IAAI,GAAG,MAAMF,GAAG,CAACG,IAAI,CAAC,CAAC;MAC3BX,OAAO,CAACK,GAAG,UAAAE,MAAA,CAAUG,IAAI,CAAE,CAAC;MAC5B,IAAIA,IAAI,CAACT,IAAI,IAAIS,IAAI,CAACnB,IAAI,KAAK,eAAe,EAAE;QAC7CqB,KAAK,CAAC,oEAAoE,CAAC;QAC3E;MACH;MACIR,cAAc,CAAC;QACXZ,KAAK,EAAEkB,IAAI,CAAClB,KAAK;QACjBD,IAAI,EAAEmB,IAAI,CAACnB,IAAI;QACfsB,OAAO,EAAEH,IAAI,CAACG,OAAO;QACrBC,IAAI,EAAEJ,IAAI,CAACI;MACb,CAAC,CAAC;IACL,CAAC,CAAC,OAAOf,KAAK,EAAE;MACpBC,OAAO,CAACD,KAAK,CAAC,8BAA8B,EAAEA,KAAK,CAACE,IAAI,EAAEF,KAAK,CAACG,OAAO,CAAC;MACxE,OAAOH,KAAK;IAChB;EACR,CAAC,CAAC,OAAOA,KAAK,EAAE;IACZC,OAAO,CAACD,KAAK,CAAC,iCAAiC,EAAEA,KAAK,CAACE,IAAI,EAAEF,KAAK,CAACG,OAAO,CAAC;IAC3E,OAAOH,KAAK;EAChB;AACJ;AAEA,eAAegB,MAAMA,CAAA,EAAG;EACpB,IAAI;IACA,MAAMrC,OAAO,CAACW,IAAI,CAAC;IACnB;EACJ,CAAC,CAAC,OAAOU,KAAK,EAAE;IACZC,OAAO,CAACD,KAAK,CAAC,sBAAsB,EAAEA,KAAK,CAAC;IAC5C,MAAMA,KAAK;EACf;AACJ;AAEA,eAAeiB,kBAAkBA,CAAA,EAAG;EAChC,MAAMC,IAAI,GAAG5B,IAAI,CAAC6B,WAAW;EAE7B,IAAID,IAAI,EAAE;IACN,MAAME,gBAAgB,oBAAoB;IAC9C,IAAI;MACA,MAAMX,GAAG,GAAG,MAAMC,KAAK,CAACU,gBAAgB,CAAC;MACzC,IAAIX,GAAG,CAACY,EAAE,EAAE;QACR,IAAIH,IAAI,GAAG,MAAMT,GAAG,CAACG,IAAI,CAAC,CAAC;QAC3B,IAAI,CAACM,IAAI,CAACzB,KAAK,EAAE;UACbY,cAAc,CAAC;YACXb,IAAI,EAAE,EAAE;YACRC,KAAK,EAAE,EAAE;YACTqB,OAAO,EAAE,CAAC;YACVpB,QAAQ,EAAE,EAAE;YACZqB,IAAI,EAAE;UACV,CAAC,CAAC;UACFO,QAAQ,CAAC,GAAG,CAAC;QACjB;MACJ;IACJ,CAAC,CAAC,OAAMC,GAAG,EAAE;MACTtB,OAAO,CAACD,KAAK,CAACuB,GAAG,CAAC;IACtB;EACA,CAAC,MAAM;IACN,OAAOtB,OAAO,CAACK,GAAG,gBAAgB,CAAC;EACpC;AACJ;AAEEkB,MAAM,CAACC,OAAO,GAAG;EAAClC,cAAc;EAAEa,aAAa;EAAEY,MAAM;EAAEC;AAAkB,CAAC","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}