{"ast":null,"code":"import React, { useEffect } from \"react\";\nimport { Card, CurrentUser } from \"./context\";\nimport { checkAuthentication, getBalance } from \"./loading\";\nimport { useNavigate } from \"react-router-dom\";\nexport default function Transfer() {\n  const {\n    currentUser,\n    setCurrentUser\n  } = React.useContext(CurrentUser);\n  const [transferAmount, setTransferAmount] = React.useState(0);\n  const [lastTransfer, setLastTransfer] = React.useState(0);\n  const [toEmail, setToEmail] = React.useState('');\n  const [formFilled, setFormFilled] = React.useState(true);\n  const [transferComplete, setTransferComplete] = React.useState(false);\n  const [loading, setLoading] = React.useState(true);\n  const navigate = useNavigate();\n  useEffect(() => {\n    async function loadPage() {\n      if (currentUser.email === '' || !currentUser) {\n        await checkAuthentication(setCurrentUser, navigate);\n      } else {\n        await getBalance(setCurrentUser, currentUser.email);\n        console.log(\"current user: \".concat(currentUser.email, \", \").concat(currentUser.balance));\n      }\n      setLoading(false);\n    }\n    loadPage();\n  }, []);\n  useEffect(() => {\n    console.log(\"transfer amount: \".concat(transferAmount, \", to email: \").concat(toEmail));\n  }, [transferAmount, toEmail]);\n  async function makeTransfer(e) {\n    e.preventDefault();\n    try {\n      // Perform validation checks\n      if (isNaN(Number(transferAmount))) {\n        alert('Your transfer must be a valid number.');\n        return;\n      }\n      if (Number(transferAmount) <= 0) {\n        alert('Your transfer cannot be a negative number.');\n        return;\n      }\n      if (Number(transferAmount) > Number(currentUser.balance)) {\n        alert('Your balance is too low. Please enter a lower amount.');\n        return;\n      }\n      if (!Number.isInteger(Number(transferAmount))) {\n        alert('Error: You must transfer dollars only, not cents. Please round up or down and try again.');\n        return;\n      }\n      if (toEmail === currentUser.email) {\n        alert(\"You cannot transfer money to yourself. Please enter a valid recipient.\");\n        return;\n      }\n      if (!toEmail.match(/^(([^<>()[\\]\\\\.,;:\\s@\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/)) {\n        alert('You must enter a valid email address for the recipient. Please try again.');\n        return;\n      }\n\n      // Fetch recipient's balance\n      let receiveUserBalanceURL = \"/account/balance/\".concat(toEmail);\n      const res2 = await fetch(receiveUserBalanceURL);\n      if (!res2.ok) {\n        throw new Error(\"Failed to fetch recipient's balance: \".concat(res2.status));\n      }\n      const data2 = await res2.json();\n      console.log('Recipient balance data:', data2);\n      if (!data2) {\n        throw new Error(\"Recipient's account data not found\");\n      }\n\n      // Perform transfer\n      let newFromBalance = parseInt(currentUser.balance) - parseInt(transferAmount);\n      let newToBalance = parseInt(data2.balance) + parseInt(transferAmount);\n      const url = \"/account/transfer/\".concat(currentUser.email, \"/\").concat(toEmail, \"/\").concat(transferAmount, \"/\").concat(newFromBalance, \"/\").concat(newToBalance);\n      await fetch(url);\n\n      // Update current user's balance\n      setCurrentUser(user => ({\n        ...user,\n        balance: newFromBalance\n      }));\n\n      // Reset form fields and update UI\n      setLastTransfer(transferAmount);\n      setTransferAmount(0);\n      setToEmail('');\n      setTransferComplete(true);\n    } catch (error) {\n      console.error('Transfer failed:', error);\n      alert('Failed to make transfer. Please try again.');\n    }\n  }\n  React.useEffect(() => {\n    setFormFilled(transferAmount != '0' && transferAmount != '' && toEmail != null && toEmail != '');\n  }, [transferAmount, toEmail]);\n  return /*#__PURE__*/React.createElement(React.Fragment, null, !loading && /*#__PURE__*/React.createElement(Card, {\n    bgcolor: \"primary\",\n    txtcolor: \"white\",\n    header: \"Make a Transfer\",\n    text: \"\".concat(currentUser.name, \", your balance is $\").concat(currentUser.balance, \".\"),\n    title: transferComplete && \"You have successfully transferred $\".concat(lastTransfer, \"!\"),\n    body: /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(\"form\", null, \"Transfer Amount\", /*#__PURE__*/React.createElement(\"br\", null), /*#__PURE__*/React.createElement(\"input\", {\n      type: \"input\",\n      className: \"form-control\",\n      id: \"transfer\",\n      placeholder: \"Enter Transfer Amount\",\n      value: transferAmount,\n      onChange: e => {\n        setTransferAmount(e.currentTarget.value);\n        setTransferComplete(false);\n      }\n    }), \" \", /*#__PURE__*/React.createElement(\"br\", null), \"Transfer To\", /*#__PURE__*/React.createElement(\"br\", null), /*#__PURE__*/React.createElement(\"input\", {\n      type: \"input\",\n      className: \"form-control\",\n      id: \"recipient\",\n      placeholder: \"Enter Email\",\n      value: toEmail,\n      onChange: e => {\n        setToEmail(e.currentTarget.value);\n        setTransferComplete(false);\n      }\n    }), \" \", /*#__PURE__*/React.createElement(\"br\", null), /*#__PURE__*/React.createElement(\"button\", {\n      type: \"submit\",\n      className: \"btn btn-light\",\n      onClick: makeTransfer,\n      disabled: !formFilled\n    }, \"Make Transfer\"), \" \", /*#__PURE__*/React.createElement(\"br\", null)))\n  }), \" \");\n}","map":{"version":3,"names":["React","useEffect","Card","CurrentUser","checkAuthentication","getBalance","useNavigate","Transfer","currentUser","setCurrentUser","useContext","transferAmount","setTransferAmount","useState","lastTransfer","setLastTransfer","toEmail","setToEmail","formFilled","setFormFilled","transferComplete","setTransferComplete","loading","setLoading","navigate","loadPage","email","console","log","concat","balance","makeTransfer","e","preventDefault","isNaN","Number","alert","isInteger","match","receiveUserBalanceURL","res2","fetch","ok","Error","status","data2","json","newFromBalance","parseInt","newToBalance","url","user","error","createElement","Fragment","bgcolor","txtcolor","header","text","name","title","body","type","className","id","placeholder","value","onChange","currentTarget","onClick","disabled"],"sources":["/Users/Regan/Documents/GitHub/BadBank/public/src/Components/transfer.js"],"sourcesContent":["import React, {useEffect} from \"react\";\nimport { Card, CurrentUser } from \"./context\";\nimport {checkAuthentication, getBalance} from \"./loading\"\nimport { useNavigate } from \"react-router-dom\";\n\nexport default function Transfer(){\n    const { currentUser, setCurrentUser } = React.useContext(CurrentUser);\n    const [transferAmount, setTransferAmount] = React.useState(0);\n    const [lastTransfer, setLastTransfer] = React.useState(0);\n    const [toEmail, setToEmail] = React.useState('');\n    const [formFilled, setFormFilled] = React.useState(true);\n    const [transferComplete, setTransferComplete] = React.useState(false);\n    const [loading, setLoading] = React.useState(true);\n    const navigate = useNavigate();\n\n    useEffect(() => {\n        async function loadPage() {\n            if (currentUser.email === '' || !currentUser) {\n                await checkAuthentication(setCurrentUser, navigate);\n            } \n            else {\n                await getBalance(setCurrentUser, currentUser.email);\n                console.log(`current user: ${currentUser.email}, ${currentUser.balance}`)\n            }\n            setLoading(false);\n        }\n        loadPage();\n    }, []);\n\n    useEffect(() => {\n       console.log(`transfer amount: ${transferAmount}, to email: ${toEmail}`);\n    }, [transferAmount, toEmail]);\n\n    async function makeTransfer(e) {  \n        e.preventDefault();\n        try {\n            // Perform validation checks\n            if (isNaN(Number(transferAmount))) {\n                alert('Your transfer must be a valid number.'); \n                return;\n            }\n            if ((Number(transferAmount)) <= 0) {\n                alert('Your transfer cannot be a negative number.'); \n                return;\n            }\n            if (Number(transferAmount) > Number(currentUser.balance)) {\n                alert('Your balance is too low. Please enter a lower amount.'); \n                return;\n            }\n            if (!Number.isInteger(Number(transferAmount))) {\n                alert('Error: You must transfer dollars only, not cents. Please round up or down and try again.'); \n                return;\n            }\n            if (toEmail === currentUser.email){\n                alert(\"You cannot transfer money to yourself. Please enter a valid recipient.\")\n                return;\n            }\n            if (!toEmail.match(/^(([^<>()[\\]\\\\.,;:\\s@\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/)) {\n                alert('You must enter a valid email address for the recipient. Please try again.'); \n                return;\n            }\n    \n            // Fetch recipient's balance\n            let receiveUserBalanceURL = `/account/balance/${toEmail}`;\n            const res2 = await fetch(receiveUserBalanceURL);\n    \n            if (!res2.ok) {\n                throw new Error(`Failed to fetch recipient's balance: ${res2.status}`);\n            }\n    \n            const data2 = await res2.json();\n            console.log('Recipient balance data:', data2);\n    \n            if (!data2) {\n                throw new Error(\"Recipient's account data not found\");\n            }\n    \n            // Perform transfer\n            let newFromBalance = parseInt(currentUser.balance) - parseInt(transferAmount);\n            let newToBalance = parseInt(data2.balance) + parseInt(transferAmount);\n    \n            const url = `/account/transfer/${currentUser.email}/${toEmail}/${transferAmount}/${newFromBalance}/${newToBalance}`;\n            await fetch(url);\n    \n            // Update current user's balance\n            setCurrentUser(user => ({\n                ...user,\n                balance: newFromBalance\n            }));\n    \n            // Reset form fields and update UI\n            setLastTransfer(transferAmount);\n            setTransferAmount(0);\n            setToEmail('');\n            setTransferComplete(true);\n    \n        } catch (error) {\n            console.error('Transfer failed:', error);\n            alert('Failed to make transfer. Please try again.');\n        }\n    }\n    \n    \n    \n    React.useEffect(() =>{\n        setFormFilled(transferAmount != '0' && transferAmount != '' && toEmail != null && toEmail != ''); \n    }, [transferAmount, toEmail])\n\n    return (\n        <>\n        {!loading && (\n        <Card \n        bgcolor=\"primary\"\n        txtcolor=\"white\"\n        header=\"Make a Transfer\"\n        text={`${currentUser.name}, your balance is $${currentUser.balance}.`}       \n        title={transferComplete && `You have successfully transferred $${lastTransfer}!`}       \n        body={\n            <>\n            <form>\n            Transfer Amount<br/>\n            <input type=\"input\" className=\"form-control\" id=\"transfer\" placeholder=\"Enter Transfer Amount\" value={transferAmount} onChange={e => {\n                setTransferAmount(e.currentTarget.value);\n                setTransferComplete(false);\n                }} /> <br /> \n            Transfer To<br/>\n            <input type=\"input\" className=\"form-control\" id=\"recipient\" placeholder=\"Enter Email\" value={toEmail} onChange={e => {\n                setToEmail(e.currentTarget.value);\n                setTransferComplete(false);\n                }} /> <br />     \n                 <button type=\"submit\" className=\"btn btn-light\" onClick={makeTransfer} disabled={!formFilled}>Make Transfer</button> <br />\n                 </form>\n                 \n        </>\n        }\n        />\n        )} </>\n     );\n }"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}