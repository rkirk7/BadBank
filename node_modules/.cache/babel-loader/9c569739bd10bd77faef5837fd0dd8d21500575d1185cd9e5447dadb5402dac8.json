{"ast":null,"code":"import React, { useEffect } from \"react\";\nimport { Card, CurrentUser } from \"./context\";\nimport { checkAuthentication, getBalance } from \"./loading\";\nimport { useNavigate } from \"react-router-dom\";\nexport default function Transfer() {\n  const {\n    currentUser,\n    setCurrentUser\n  } = React.useContext(CurrentUser);\n  const [transferAmount, setTransferAmount] = React.useState(0);\n  const [lastTransfer, setLastTransfer] = React.useState(0);\n  const [toEmail, setToEmail] = React.useState('');\n  const [fromBalance, setFromBalance] = React.useState(currentUser.balance);\n  const [toBalance, setToBalance] = React.useState(0);\n  const [formFilled, setFormFilled] = React.useState(true);\n  const [transferComplete, setTransferComplete] = React.useState(false);\n  const [loading, setLoading] = React.useState(true);\n  const navigate = useNavigate();\n  useEffect(() => {\n    async function loadPage() {\n      if (currentUser.email === '') {\n        await checkAuthentication(setCurrentUser, navigate);\n        setLoading(false);\n      } else {\n        await retrieveBalances();\n      }\n    }\n    loadPage();\n  }, []);\n  let receiveUserBalanceURL = '';\n  const currentUserBalanceURL = \"/account/balance/\".concat(currentUser.email);\n  if (toEmail) {\n    receiveUserBalanceURL = \"/account/balance/\".concat(toEmail);\n  }\n  async function retrieveBalances() {\n    var res = await fetch(currentUserBalanceURL);\n    var data = await res.json();\n    setFromBalance(data.balance);\n    if (toEmail) {\n      try {\n        var res2 = await fetch(receiveUserBalanceURL);\n        var data2 = await res2.json();\n        setToBalance(data2.balance);\n        setLoading(false);\n      } catch {\n        alert(\"Error: Could not find recipient's account. Please check their email and try again.\");\n        return;\n      }\n    }\n  }\n  async function makeTransfer() {\n    if (isNaN(Number(transferAmount))) {\n      alert('Your transfer must be a valid number.');\n      return;\n    }\n    if (Number(transferAmount) <= 0) {\n      alert('Your transfer cannot be a negative number.');\n      return;\n    }\n    if (Number(transferAmount) > Number(fromBalance)) {\n      alert('Your balance is too low. Please enter a lower amount.');\n      return;\n    }\n    if (!Number.isInteger(Number(transferAmount))) {\n      alert('Error: You must transfer dollars only, not cents. Please round up or down and try again.');\n      return;\n    }\n    if (toEmail === currentUser.email) {\n      alert(\"You cannot transfer money to yourself. Please enter a valid recipient.\");\n      return;\n    }\n    if (toEmail === '') {\n      alert('You must enter a valid email address for the recipient. Please try again.');\n      return;\n    }\n    receiveUserBalanceURL = \"/account/balance/\".concat(toEmail);\n    async function getRecipientBalance() {\n      try {\n        var res2 = await fetch(receiveUserBalanceURL);\n        var data2 = await res2.json();\n        if (!data2) {\n          alert(\"Error: Could not find recipient's account. Please check their email and try again.\");\n          return;\n        }\n        let newFromBalance = parseInt(fromBalance) - parseInt(transferAmount);\n        let newToBalance = parseInt(data2.balance) + parseInt(transferAmount);\n        setFromBalance(newFromBalance);\n        setToBalance(newToBalance);\n        const url = \"/account/transfer/\".concat(currentUser.email, \"/\").concat(toEmail, \"/\").concat(transferAmount, \"/\").concat(newFromBalance, \"/\").concat(newToBalance);\n        (async () => {\n          console.log('fetching url:', url);\n          let result = await fetch(url);\n          setCurrentUser(user => ({\n            ...user,\n            balance: fromBalance\n          }));\n          setLastTransfer(transferAmount);\n          setTransferAmount(0);\n          setToEmail('');\n          setTransferComplete(true);\n        })();\n      } catch {\n        alert(\"Error: Could not find recipient's account. Please check their email and try again.\");\n        return;\n      }\n    }\n    await getRecipientBalance();\n  }\n  React.useEffect(() => {\n    setFormFilled(transferAmount != '0' && transferAmount != '' && toEmail != null && toEmail != '');\n  }, [transferAmount, toEmail]);\n  return /*#__PURE__*/React.createElement(React.Fragment, null, !loading && /*#__PURE__*/React.createElement(Card, {\n    bgcolor: \"primary\",\n    txtcolor: \"white\",\n    header: \"Make a Transfer\",\n    text: \"\".concat(currentUser.name, \", your balance is $\").concat(fromBalance, \".\"),\n    title: transferComplete && \"You have successfully transferred $\".concat(lastTransfer, \"!\"),\n    body: /*#__PURE__*/React.createElement(React.Fragment, null, \"Transfer Amount\", /*#__PURE__*/React.createElement(\"br\", null), /*#__PURE__*/React.createElement(\"input\", {\n      type: \"input\",\n      className: \"form-control\",\n      id: \"transfer\",\n      placeholder: \"Enter Transfer Amount\",\n      value: transferAmount,\n      onChange: e => {\n        setTransferAmount(e.currentTarget.value);\n        setTransferComplete(false);\n      }\n    }), \" \", /*#__PURE__*/React.createElement(\"br\", null), \"Transfer To\", /*#__PURE__*/React.createElement(\"br\", null), /*#__PURE__*/React.createElement(\"input\", {\n      type: \"input\",\n      className: \"form-control\",\n      id: \"recipient\",\n      placeholder: \"Enter Email\",\n      value: toEmail,\n      onChange: e => {\n        setToEmail(e.currentTarget.value);\n        setTransferComplete(false);\n      }\n    }), \" \", /*#__PURE__*/React.createElement(\"br\", null)),\n    centered: /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(\"button\", {\n      type: \"submit\",\n      className: \"btn btn-light\",\n      onClick: makeTransfer,\n      disabled: !formFilled\n    }, \"Make Transfer\"), \" \", /*#__PURE__*/React.createElement(\"br\", null))\n  }), \" \");\n}","map":{"version":3,"names":["React","useEffect","Card","CurrentUser","checkAuthentication","getBalance","useNavigate","Transfer","currentUser","setCurrentUser","useContext","transferAmount","setTransferAmount","useState","lastTransfer","setLastTransfer","toEmail","setToEmail","fromBalance","setFromBalance","balance","toBalance","setToBalance","formFilled","setFormFilled","transferComplete","setTransferComplete","loading","setLoading","navigate","loadPage","email","retrieveBalances","receiveUserBalanceURL","currentUserBalanceURL","concat","res","fetch","data","json","res2","data2","alert","makeTransfer","isNaN","Number","isInteger","getRecipientBalance","newFromBalance","parseInt","newToBalance","url","console","log","result","user","createElement","Fragment","bgcolor","txtcolor","header","text","name","title","body","type","className","id","placeholder","value","onChange","e","currentTarget","centered","onClick","disabled"],"sources":["/Users/Regan/Documents/GitHub/BadBank/public/src/Components/transfer.js"],"sourcesContent":["import React, {useEffect} from \"react\";\nimport { Card, CurrentUser } from \"./context\";\nimport {checkAuthentication, getBalance} from \"./loading\"\nimport { useNavigate } from \"react-router-dom\";\n\n\nexport default function Transfer(){\n    const { currentUser, setCurrentUser } = React.useContext(CurrentUser);\n    const [transferAmount, setTransferAmount] = React.useState(0);\n    const [lastTransfer, setLastTransfer] = React.useState(0);\n    const [toEmail, setToEmail] = React.useState('');\n    const [fromBalance, setFromBalance] = React.useState(currentUser.balance);\n    const [toBalance, setToBalance] = React.useState(0);\n    const [formFilled, setFormFilled] = React.useState(true);\n    const [transferComplete, setTransferComplete] = React.useState(false);\n    const [loading, setLoading] = React.useState(true);\n    const navigate = useNavigate();\n\n    useEffect(() => {\n        async function loadPage() {\n            if (currentUser.email === '') {\n                await checkAuthentication(setCurrentUser, navigate);\n                setLoading(false);\n            } \n            else {\n                await retrieveBalances();\n            }\n        }\n        loadPage();\n    }, []);\n    \n      let receiveUserBalanceURL = '';\n      const currentUserBalanceURL = `/account/balance/${currentUser.email}`;\n      if (toEmail) {\n       receiveUserBalanceURL = `/account/balance/${toEmail}`;\n      }\n\n      async function retrieveBalances() {\n        var res = await fetch(currentUserBalanceURL);\n        var data = await res.json();\n        setFromBalance(data.balance);\n        if (toEmail) {\n        try {\n        var res2 = await fetch(receiveUserBalanceURL);\n        var data2 = await res2.json();\n        setToBalance(data2.balance);\n        setLoading(false);\n        } catch {\n            alert(\"Error: Could not find recipient's account. Please check their email and try again.\")\n            return;\n        }\n    }\n     }\n\n    async function makeTransfer() {\n           if (isNaN(Number(transferAmount))) {\n            alert('Your transfer must be a valid number.'); \n            return;\n        }\n        if ((Number(transferAmount)) <= 0) {\n            alert('Your transfer cannot be a negative number.'); \n            return;\n        }\n\n        if (Number(transferAmount) > Number(fromBalance)) {\n            alert('Your balance is too low. Please enter a lower amount.'); \n            return;\n        }\n        if (!Number.isInteger(Number(transferAmount))) {\n            alert('Error: You must transfer dollars only, not cents. Please round up or down and try again.'); \n            return;\n        }\n        if (toEmail === currentUser.email){\n            alert(\"You cannot transfer money to yourself. Please enter a valid recipient.\")\n            return;\n        }\n\n        if (toEmail === '') {\n            alert('You must enter a valid email address for the recipient. Please try again.'); \n            return;\n           }\n\n           receiveUserBalanceURL = `/account/balance/${toEmail}`;\n\n           async function getRecipientBalance() {\n            try {\n            var res2 = await fetch(receiveUserBalanceURL);\n            var data2 = await res2.json();\n            if (!data2) {\n                alert(\"Error: Could not find recipient's account. Please check their email and try again.\")\n                return;\n            }\n            let newFromBalance = parseInt(fromBalance) - parseInt(transferAmount);\n            let newToBalance = parseInt(data2.balance) + parseInt(transferAmount);\n           setFromBalance(newFromBalance);\n           setToBalance(newToBalance);\n    \n            const url = `/account/transfer/${currentUser.email}/${toEmail}/${transferAmount}/${newFromBalance}/${newToBalance}`;\n\n        (async () => {\n            console.log('fetching url:', url);\n           let result = await fetch(url);\n           \n           setCurrentUser(user => ({\n            ...user,\n            balance: fromBalance\n          })); \n            setLastTransfer(transferAmount);\n            setTransferAmount(0);\n            setToEmail('');\n            setTransferComplete(true);\n        })();\n            } catch {\n                alert(\"Error: Could not find recipient's account. Please check their email and try again.\")\n            return;\n            }\n        }\n\n        await getRecipientBalance();\n    }\n    \n\n    React.useEffect(() =>{\n        setFormFilled(transferAmount != '0' && transferAmount != '' && toEmail != null && toEmail != ''); \n    }, [transferAmount, toEmail])\n\n\n    return (\n        <>\n        {!loading && (\n        <Card \n        bgcolor=\"primary\"\n        txtcolor=\"white\"\n        header=\"Make a Transfer\"\n        text={`${currentUser.name}, your balance is $${fromBalance}.`}       \n        title={transferComplete && `You have successfully transferred $${lastTransfer}!`}       \n        body={\n            <>\n            Transfer Amount<br/>\n            <input type=\"input\" className=\"form-control\" id=\"transfer\" placeholder=\"Enter Transfer Amount\" value={transferAmount} onChange={e => {\n                setTransferAmount(e.currentTarget.value);\n                setTransferComplete(false);\n                }} /> <br /> \n            Transfer To<br/>\n            <input type=\"input\" className=\"form-control\" id=\"recipient\" placeholder=\"Enter Email\" value={toEmail} onChange={e => {\n                setToEmail(e.currentTarget.value);\n                setTransferComplete(false);\n                }} /> <br />     \n        </>\n        }\n        centered={\n    <>\n            <button type=\"submit\" className=\"btn btn-light\" onClick={makeTransfer} disabled={!formFilled}>Make Transfer</button> <br />\n    </>\n        }\n        />\n        )} </>\n     );\n }"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}